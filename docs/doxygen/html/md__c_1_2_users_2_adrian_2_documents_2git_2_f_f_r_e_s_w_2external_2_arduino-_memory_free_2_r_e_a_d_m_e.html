<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FFRESW: Arduino library for Measuring and use less Free RAM</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">FFRESW
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Arduino library for Measuring and use less Free RAM</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md0"></a> This Library was written for the Arduino to both measure available RAM and use less RAM</p>
<p>Did you know that the Arduino's built in serial.print() of a constant char array</p>
<div class="fragment"><div class="line">Serial.Print(<span class="stringliteral">&quot;Hello&quot;</span>);</div>
</div><!-- fragment --><p>Actually allocates the "Hello" into a unique space of RAM, not just Flash. Hence every such occurrence of serial print of a constant string uses more and more RAM. Until you are out. And there is only 2K of RAM on the ATmega328. This is likely why you don't see many examples with a lot of debug prints.</p>
<p>That said there is hope, use the "F()" function. Now natively supported in the IDE &gt; 1.0.0. Same concept applies.</p>
<p>Previously, I have both been suggested and found several work-a-rounds all similar in forcing the char array to be read directly from memory at print time. This can be done using some not as obvious AVR Libc commands provided with avr/pgmspace.h. Where the pgmStrToRAM library provides a simplified library to do such.</p>
<p>Additionally the companion library MemoryFree is very useful in determining how much RAM is being used or left. Don't wonder or guess. I find it good practice to always dump it during setup to see the global static usage. Just in case.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Installation</h1>
<ul>
<li>Download the Library <a href="https://github.com/mpflaga/Arduino-MemoryFree.git">https://github.com/mpflaga/Arduino-MemoryFree.git</a></li>
<li>It will contain the following to be placed into corresponding library directories:</li>
</ul>
<div class="fragment"><div class="line">.\pgmStrToRAM\MemoryFree.cpp</div>
<div class="line">.\pgmStrToRAM\MemoryFree.h</div>
<div class="line">.\pgmStrToRAM\pgmStrToRAM.cpp</div>
<div class="line">.\pgmStrToRAM\pgmStrToRAM.h</div>
<div class="line">.\pgmStrToRAM\examples\BareMinimum\BareMinimum.ino&lt;/pre&gt;</div>
</div><!-- fragment --><ul>
<li>Place the pgmStrToRAM directory folder and contents into your arduino library folder, if the libraries folder does not exist - create it first!</li>
<li>Restart the IDE</li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Example Usage</h1>
<p>BareMinimum.ino is a example of usage that both demonstrates how to print out the current available memory at the time the freeMemory() is executed along with how to using getPSTR("hello") to put the "hello" into Flash without using any static RAM.</p>
<p>include the desired library(s) at the beginning of sketch</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;MemoryFree.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;pgmStrToRAM.h&gt;</span></div>
</div><!-- fragment --><p>then at the desired location</p>
<div class="fragment"><div class="line">Serial.println(getPSTR(<span class="stringliteral">&quot;Old way to force String to Flash&quot;</span>));</div>
<div class="line">Serial.println(F(<span class="stringliteral">&quot;New way to force String to Flash&quot;</span>));</div>
<div class="line">Serial.println(F(<span class="stringliteral">&quot;Free RAM = &quot;</span>));</div>
</div><!-- fragment --><p>Please note that the memory is dynamic and always changing. Where Static Global Variables and Members&#160; create a base minimum of usage that can typically be read at setup(). When functions and routines dive deeper into the stack more memory will be dynamically consumed and released. So there needs to be a margin from completely running out.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Back Ground</h1>
<p>Based on my tests I see that Serial.Print of actual variables e.g. Serial.Print( (int8_t) value, DEC); Does not increase RAM usage for each occurrence. However it would appear that overloaded object member of an char array (e.i. const string) creates a unique location in static RAM and definitely does not share it. As one might think or expect.</p>
<p>A more indepth look at avr-libc and its features can be found at <a href="http://www.nongnu.org/avr-libc/user-manual/pgmspace.html">http://www.nongnu.org/avr-libc/user-manual/pgmspace.html</a></p>
<h1><a class="anchor" id="autotoc_md4"></a>
Alternatives</h1>
<p>It is worth noting that there are many other sources of equivalent methods. Although note widely known. One such alternative is "SdFATlib" found at <a href="http://code.google.com/p/sdfatlib/">http://code.google.com/p/sdfatlib/</a> library file called SdFatUtil.h</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;SdFat.h&gt;</span>  <span class="comment">// required</span></div>
<div class="line"><span class="preprocessor">#include &lt;SdFatUtil.h&gt;</span></div>
<div class="line"> </div>
<div class="line">PgmPrint(<span class="stringliteral">&quot;Free RAM: &quot;</span>);</div>
<div class="line">Serial.println(FreeRam());</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md5"></a>
Gratitude</h1>
<p>Special Thanks to GreyGnome, William Greiman and others for providing the example this is based off. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
